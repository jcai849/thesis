This section describes more on the implementation of \pkg{largescaler}, with a focus on the constuction of its API using the offerings provided by the lower layer.

\subsection{Distributed Computation}

do.dcall, d

\subsection{Methods}

The methods provided by \lsr all follow a similar pattern.

For instance, \code{summary()} follows a basic pattern of running a distributed call over a distributed object to summarise each chunk on their corresponding nodes, and then emerging them, pulling them locally and running the some summary function on their  emerged values.
This works for transitive functions such as \code{min()} and \code{max()}, though isn't accurate for \code{median()} or other non-transitive functions.
This is effectively a map reduce operation and this is just one of many higher-level operations that is enabled through doing a distributed call and then pulling, then running some summary function over the implicitly combined emerged values.

As a demonstration of the power granted by the primitives given by this layer, the full implementation of Math and Summary methods for distributed objects is given in Listing \ref{lst:mathsum}.
Here, Summary is a degenerate Map Reduce, with the implementation of the higher-order \code{map\_reduce} function given as well. The definition of \code{Summary} automatically grants the functions \code{all}, \code{any}, \code{sum}, \code{prod}, \code{min}, \code{max}, \code{range}. 

\begin{listing}
\begin{minted}{r}
Math.DistributedObject <- function(x, ...)
        do.dcall(.Generic, c(list(x=x), list(...)))

map_reduce <- function(map, reduce) {
        function(..., addl_map_args, addl_reduce_args) {
                mapped <- emerge(do.dcall(map, c(list(...), addl_map_args)))
                do.call(reduce, c(list(mapped), addl_reduce_args)) # reduced
        }
}

Summary.DistributedObject <- function(..., na.rm = FALSE)  
        map_reduce(.Generic, .Generic)(..., addl_map_args=list(na.rm=na.rm), addl_reduce_args=list(na.rm=na.rm)) 
\end{minted}
\caption{Math and Summary methods defined by largescaler primitives, as well as map\_reduce}
\label{lst:mathsum}
\end{listing}
